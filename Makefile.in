ESS_TRACK?=
target_bin?=
ODIR?=

IDIR?=

EXT_OBJS?=
#List obj that we want to compile
_OBJ ?=

#Gives lib dir and lib name for the target
LDIR?=
LIBS?=





#Creat a
CFLAGS=$(addprefix -I,$(IDIR)) $(FLAGS)
OBJ = $(patsubst %,$(ODIR)/%,$(_OBJ))


$(ODIR)/%.opp: %.cpp   $(ESS_TRACK)
	$(CXX) -c $< $(CFLAGS) -o $@
$(ODIR)/%.o: %.c  $(ESS_TRACK)
	$(CXX) -c $< $(CFLAGS) -o $@


.PHONY: clean prepare $(SUB_MAKEFILES) build_objs domake


domake: prepare  $(SUB_MAKEFILES) build_objs $(target_bin)
	@echo Done GOAL:\"$(MAKECMDGOALS)\" `pwd` 

$(target_bin):$(OBJ) $(EXT_OBJS)
	$(CXX) $(OBJ) $(EXT_OBJS)  $(CFLAGS) $(LIBS)  -o $@


$(SUB_MAKEFILES):
	make -C $@ MakeTemplate=$(MakeTemplate) $(MAKECMDGOALS)


#VARS_LIST := $(.VARIABLES)

prepare:
	-@mkdir -p $(ODIR)

build_objs:$(OBJ)

clean:$(SUB_MAKEFILES)
	rm -rf $(ODIR) *~ core $(INCDIR)/*~ $(target_bin)
